{% extends('ppal.html.twig') %}
{% block stylesheets %}
	{{ parent() }}
 	<link rel="stylesheet" href="{{ asset('bundles/mantalmacen/css/movimientos/addArticulosMovimiento.css')}}">
 	<link rel="stylesheet" href="{{ asset('bundles/mantalmacen/css/estilos.css')}}">
{% endblock %}

{% block body %}
	{{ parent() }}
<div class="container">
	
	<div class="card">
  <div class="card-header">
  	<div class='row'>
  		<div class="col-2">
  			{{ factura.getDescripcionFormulario | title }}
  		</div>
	    <div class="col-3">
	    	{{ factura.almacenOrigen }}
	    </div>
	    <div class="col-4">
	    	Cliente: {{ factura.cliente }}
	    </div>
		<div class="col-3">
			Fecha: {{ factura.fecha | date("m/d/Y") }}
		</div>
  	</div>

  </div>
</div>
   <div class="card">
    <div class="card-body">
    	<h6>Items cargados</h6>
    	<table class="table table-striped table-hover table-bordered table-sm assign estilo1">
					<thead>
						<tr>
                            <th>Descripcion</th>
                            <th>Cantidad</th>
                            <th>Costo Unitario</th>
                            <th>Unitario</th>           
                            <th>Total</th> 
                            <th>Quitar</th>
						</tr>
					</thead>
					<tbody>
				        {% for item in factura.items %}
                            <tr id="{{ item.id }}" class="trtable">
                                <td>{{ item.articulo.articulo.descripcion|title }}</td>
                                <td>{{ item.cantidad|number_format(2, '.', '')  }}</td>         
								<td>{{ item.costo|number_format(2, '.', '')  }}</td>                                                             
                                <td>{{ item.precioUnitario|number_format(2, '.', '')  }}</td>       
                                <td>{{ item.precioTotal|number_format(2, '.', '')  }}</td>
                                <td><input type='button' class='btn btn-danger btn-sm delit' value='X' onClick='removeItem("{{path('mant_almacen_remove_item_movimiento', {'item' : item.id})}}", {{item.id}})';/> </td>
                            </tr>
				        {% endfor %}						
					</tbody>
		</table>
    </div>
  </div> 
  	{% for message in app.session.flashBag.get('error') %}
	    <div class="alert alert-danger" role="alert">
	        {{ message }}
	    </div>
	{% endfor %}
	
	  <div class="card">
	    <div class="card-body">
			  <div class="form-group">
					{{ 	form_start(notas, {'attr': {'class':'view row'}}) }}
					{{	form_widget(notas.notaspedido, {'attr':{'class' : 'form-control col-10'}})}}
					{{ form_widget(notas.save, {'attr':{'class' : 'btn btn-warning btn-add col-2'}}) }}		
					{{ form_end(notas) }}
			  </div>
			  <div id="detalle">

			  </div>			  	    		
	    </div>
	  </div>  

	 {% if form is defined %}
 	<span class="pull-right">
		<div class="row">
			<div class="col-2">
				{{ 	form_start(formcancel, {'attr': {'class':'frmcancel'}}) }}
				{{ form_widget(formcancel.cancel, {'attr':{'class' : 'btn btn-danger btn-add btncancel'}}) }}		
				{{ form_end(formcancel) }}
			</div>
			<div class="col-2">
				{{ 	form_start(formpausa, {'attr': {'class':'frmpaused'}})  }}
				{{ form_widget(formpausa.pausa, {'attr':{'class' : 'btn btn-warning btn-add btnpausa'}}) }}	
				{{ form_end(formpausa) }}	
			</div>			
			<div class="col-2">
				{{ 	form_start(formcierre, {'attr': {'class':'frmsend'}})  }}
				{{ form_widget(formcierre.save, {'attr':{'class' : 'btn btn-primary btn-add btnsend'}}) }}	
				{{ form_end(formcierre) }}	
			</div>
		</div>
	</span>
	{% endif %}
	<span class="counter pull-left"></span>
	{% if articulos is defined %}
	<div>
	 			<input type="text" class="search form-control col-4" placeholder="Descripcion/Codigo Barras">
				<table class="table table-striped table-hover table-bordered results table-sm table-fixed estilo1">
					<thead>
						<tr>
                            <th>Codigo</th>
                            <th>Descripcion</th>
                            <th>Codigo Barras</th>
                            <th>Stock Actual</th>
                            <th>Unitario</th>                            
						</tr>
    					<tr class="warning no-result">
      						<td colspan="7"><i class="fa fa-warning"></i> No se ecnontraron resultados</td>
    					</tr>						
					</thead>
					<tbody>
				        {% for articulo in articulos %}
                            <tr data-id="{{ articulo.id }}" class="trtable">
                                <td>{{ articulo.articulo.codigo|upper }}</td>
                                <td>{{ articulo.articulo.descripcion|title }}</td>
                                <td>{{ articulo.articulo.codBarras|title }}</td>                                
                                <td>{{ articulo.sActual  }}</td>
                                <td>{{ articulo.precioCompra|number_format(2, '.', '')  }}</td>
                            </tr>
				        {% endfor %}
					</tbody>
				</table>
	</div>
{% endif %}
</div>
{% endblock %}
{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript">		
		$(document).ready(function(){
									$('.view').submit(function(event){			
																		$('#detalle').html('<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>');													
																		event.preventDefault();
																		
																		var form = $(this);
																		$.post(form.attr('action'), 
																			   form.serialize(),
																			   function(data){
																			   					$('#detalle').html(data);
																			   });
									});
		});
	</script>
	
{% endblock %}